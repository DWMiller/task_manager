var dmf=function(){"use strict";var a={},b=!1;return{container:null,modules:a,config:{},data:{},events:{},templates:{},classes:{},fn:{},activate:function(a){"undefined"!=typeof a.debug&&this.debug(a.debug),this.container=document.querySelector("undefined"!=typeof a.container?a.container:"body"),this.startModule("system-controller"),"undefined"!=typeof a.startup&&this.startModule(a.startup)},debug:function(a){b="undefined"!==a?a?!0:!1:!b},extendConfig:function(a){$.extend(!0,this.config,a)},createModule:function(b,c){var d;"string"==typeof b&&"function"==typeof c?(d=c(this),d=null,a[b]={create:c,config:this.config[b],instance:null},this.log(1,"Module '"+b+"' Registration : SUCCESS")):this.log(2,"Module '"+b+"' Registration : FAILED : one or more arguments are of incorrect type")},getModule:function(b){var c=a[b];return c?c.create(this,c.config):!1},startModule:function(b){var c=a[b];c&&(c.instance=this.getModule(b),c.instance.initialize&&"function"==typeof c.instance.initialize&&c.instance.initialize(this.Sandbox.create(this,c.instance.properties)),c.instance.properties.listeners&&(this.registerEvents(c.instance.properties.listeners,b),console.log("Events Registered - "+b)),this.log(1,"Start Module '"+b+"': SUCCESS"))},startAllModules:function(){var b;for(b in a)a.hasOwnProperty(b)&&this.startModule(b)},stopModule:function(b){var c;(c=a[b])&&c.instance?(c.instance.properties.listeners&&(console.log("Events Ignored - "+b),this.removeEvents(Object.keys(c.instance.properties.listeners),b)),c.instance.destroy&&"function"==typeof c.instance.destroy?c.instance.destroy():c.instance.scope&&(c.instance.scope=null),c.instance=null,delete c.instance,this.log(1,"Stop Module '"+b+"': SUCCESS")):this.log(2,"Stop Module '"+b+"': FAILED : module does not exist or has not been started")},stopAllModules:function(){var b;for(b in a)a.hasOwnProperty(b)&&this.stopModule(b)},registerEvents:function(a,b){if(this.is_obj(a)&&b)for(var c in a)this.events[c]||(this.events[c]={}),this.events[c][b]=a[c];else this.log(1,"Error registering events for: "+b)},notify:function(a){this.is_obj(a)&&a.type&&this.triggerEvent(a)},triggerEvent:function(a){var b=this.events[a.type];if(b)for(var c in b)b[c](a.data)},removeEvents:function(a,b){a.forEach(function(a){delete dmf.events[a][b]})},log:function(a,c){if(b){this.is_arr(c)||(c=[c]);for(var d=0;d<c.length;d++)console[1===a?"log":2===a?"warn":"error"](JSON.stringify(c[d],null,4))}},changeLanguage:function(a){var b={type:"language-change",data:{language:a}};this.triggerEvent(b)},is_arr:function(a){return jQuery.isArray(a)},is_obj:function(a){return jQuery.isPlainObject(a)},extend:function(a,b){jQuery.extend(!0,a,b)}}}(),CORE=dmf;dmf.dom=function(){return{find:function(a,b){var c={};return c=b?b.querySelector(a):document.querySelector(a)},listen:function(a,b,c){a&&b&&("function"==typeof b&&(c=b,b="click"),a.addEventListener(b,c))},ignore:function(a,b,c){a&&b&&("function"==typeof b&&(c=b,b="click"),a.removeEventListener(b,c))},addClass:function(a,b){jQuery(a).addClass(b)},removeClass:function(a,b){jQuery(a).removeClass(b)},toggleClass:function(a,b){jQuery(a).toggleClass(b)},emptyNode:function(a){if(a instanceof jQuery)a.html("");else for(;a.firstChild;)a.removeChild(a.firstChild)},append:function(a,b){a instanceof jQuery||(a=$(a)),b instanceof jQuery||(b=$(b)),a.append(b)}}}(),dmf.Sandbox={create:function(a,b){var c=(b.id||null,b.selector||null),d=document.getElementById(c)||a.container;return{self:function(){return d},find:function(b){return a.dom.find(b,d)},hide:function(b){"undefined"==typeof b&&(b=d),a.dom.removeClass(b,"visible"),a.dom.addClass(b,"hidden")},show:function(b){"undefined"==typeof b&&(b=d),a.dom.addClass(b,"visible"),a.dom.removeClass(b,"hidden")}}}},dmf.extendConfig({"system-server":{endpoint:"http://127.0.0.1:8080/"},"system-localize":{default_language:"en",path:"assets/localization/",ext:".lang.json"}}),dmf.createModule("system-controller",function(a){"use strict";function b(){a.startModule("system-server"),a.startModule("system-data"),a.startModule("system-localize")}function c(){a.stopModule("system-server"),a.stopModule("system-data"),a.stopModule("system-localize")}var d={id:"system-controller",listeners:{}};return{properties:d,initialize:b,destroy:c}}),dmf.createModule("system-localize",function(a,b){"use strict";function c(){k=b.default_language,f()}function d(){j={}}function e(a){k=a.language,f()}function f(){m[k]?g():$.getJSON(b.path+k+b.ext).done(function(a){m[k]=a,g()})}function g(){console.log("Language changed to "+k),a.extend(a.data,{language:m[k]}),h()}function h(){for(var a=document.querySelectorAll(".localize"),b=0;b<a.length;b++)i(a[b])}function i(a){var b=a.getAttribute("data-localize"),c=p_getLocalizedText(b);if(!c)return!1;switch(a.tagName){case"INPUT":a.value=c;break;default:a.innerHTML=c}}var j,k,l={id:"system-localize",listeners:{"language-change":e}},m={};return{properties:l,initialize:c,destroy:d}}),dmf.createModule("system-server",function(a,b){"use strict";function c(){}function d(c){a.log(1,["REQUEST",c]),g&&(c.session=g);var d={url:b.endpoint,data:JSON.stringify(c),type:"POST",dataType:"json",crossDomain:!0};return $.ajax(d).done(function(b){a.log(1,["RESPONSE",b]);for(var c in b)a.notify({type:c,data:b[c]})}).fail(function(){}).always(function(){})}function e(a){g=a}function f(){g=null}var g,h={id:"system-server",listeners:{"server-request":c,"server-post":d,"session-set":e,"session-clear":f}};return{properties:h}}),CORE.extendConfig({room:{updateInterval:3e3},game:{updateInterval:2e3},round:{updateInterval:2e3}}),CORE.extendConfig({language:{default_language:"en",path:"assets/localization/",ext:".lang.json"}}),dmf.templates["answer-input"]=function(){var a=document.createElement("input");return a.type="text",a.className="answer-input",a},CORE.createModule("controller",function(a){"use strict";function b(){d()}function c(){a.stopAllModules()}function d(){a.startModule("menu")}function e(){a.stopModule("chat")}function f(){e(),d()}var g={id:"controller",listeners:{"state-startup":d,"state-shutdown":e,"state-restart":f}};return{properties:g,initialize:b,destroy:c}}),dmf.createModule("answer-entry",function(a){"use strict";function b(b){m=b,o.timer=m.find("#entry-timer"),k(a.data.round),o.submit=m.find("#answers-submit"),o.inputs=m.find("#answer-inputs"),o["answer-inputs"]=i(a.data.round),d(),m.show()}function c(){m.hide(),l(),e()}function d(){a.dom.listen(o.submit,"click",f)}function e(){a.dom.ignore(o.submit,"click",f)}function f(a){a.preventDefault(),g()}function g(){p.length=0,o["answer-inputs"].forEach(h),p.length>0&&(p=j(p)),a.notify({type:"server-post",data:{"round.answer":{game_id:a.data.round.game_id,round_id:a.data.round.round_id,answer_text:p}}}),a.notify({type:"answers-submitted",data:!0})}function h(a){p.push(a.value)}function i(b){var c=[];a.dom.emptyNode(o.inputs);var d=document.createElement("p");d.innerHTML="<em>"+a.data.language.enter_your_answers_expert+"</em>",a.dom.append(o.inputs,d);for(var e=0;e<b.answer_count;e++)c.push(a.templates["answer-input"]()),a.dom.append(o.inputs,c[c.length-1]);return c}function j(a){return a=a.filter(function(a){return""!==a})}function k(b){a.dom.emptyNode(o.timer),o.timer.countdown=new Countdown({selector:"#entry-timer",msgPattern:"Remaining Time: {seconds} seconds",msgAfter:"Out of time!",onEnd:g,dateEnd:new Date((new Date).getTime()+1e3*b.answer_time)})}function l(){o.timer.countdown&&(o.timer.countdown.stop(),delete o.timer.countdown)}var m,n={id:"answer-entry",selector:"round-answers-entry",listeners:{}},o={},p=[];return{properties:n,initialize:b,destroy:c}}),dmf.fn["input-focus"]=function(){this.parentNode.classList.add("focus")},dmf.fn["input-blur"]=function(){this.parentNode.classList.remove("focus"),this.value.length>0?this.parentNode.classList.add("data"):this.parentNode.classList.remove("data")};